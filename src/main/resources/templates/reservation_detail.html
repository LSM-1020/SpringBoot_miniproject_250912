<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8">
    <title>글 상세 - 동네마켓</title>
    <link rel="stylesheet" th:href="@{/css/board_detail.css}">
     <link rel="stylesheet" th:href="@{/css/style.css}">
    <script th:src="@{/js/reservation_vote.js}"></script>
</head>
<body>

<!-- Header -->
<div th:replace="/header :: header"></div>

<section class="board-detail-section">
    <div class="board-detail-container">
        <!-- 글 정보 -->
        <div class="board-header">
            <h2 th:text="${reservation.subject}">글 제목</h2>
            <div class="board-meta">
                <span>작성자: <b th:text="${reservation.author.username}">작성자</b></span>
                <span>등록일: <span th:text="${#temporals.format(reservation.createdate,'yyyy-MM-dd HH:mm')}"></span></span>
                <span th:if="${reservation.modifydate != null}">수정일: <span th:text="${#temporals.format(reservation.modifydate,'yyyy-MM-dd HH:mm')}"></span></span>
            </div>
        </div>

        <!-- 글 내용 -->
        <div class="board-content" th:text="${reservation.content}">
            글 내용
        </div>

        <!-- 추천 / 비추천 -->
        <div class="board-vote">
            <button class="vote-btn" 
                    th:onclick="'location.href=\'/reservation/vote/'+${reservation.id}+'\''">
                👍 찜하기 (<span th:text="${#lists.size(reservation.voter)}">0</span>)
            </button>
            
        </div>
					<!-- 질문 수정 버튼 -->
					<div class="board-actions">
	               <a th:href="@{|/reservation/modify/${reservation.id}|}" 
	               class="edit-btn" sec:authorize="isAuthenticated()"
	               th:if="${reservation.author != null and reservation.author.username == #authentication.getPrincipal().getUsername()}"
	               th:text="수정">수정 버튼 이름 표시</a>
	               <!-- 질문 삭제 버튼 -->
	              <a th:href="@{|/reservation/delete/${reservation.id}|}" 
				   class="delete-btn"
				   sec:authorize="isAuthenticated()"
				   th:if="${reservation.author != null and reservation.author.username == #authentication.getPrincipal().getUsername()}"
				   onclick="return confirm('정말 삭제하시겠습니까?');">삭제</a>
					<a th:href="@{/reservation/list}" class="list-btn">글 목록</a>
					</div>


        <!-- 답변 수 -->
        <div class="answer-count">
            답변 <span th:text="${#lists.size(reservation.answerList)}">0</span>개
        </div>

        <!-- 답변 작성 폼 -->
        <div class="answer-form-section" th:if="${#authentication.name != null}">
            <h3>💬 답변 작성</h3>
            <form th:object="${answerForm}" th:action="@{|/answer/create/${reservation.id}|}" method="post">
                <textarea th:field="*{content}" rows="4" placeholder="답변을 작성하세요"></textarea>
                <div class="error-msg" th:if="${#fields.hasErrors('content')}" th:errors="*{content}"></div>
                <button type="submit" class="submit-btn">답변 등록</button>
            </form>
        </div>

        <!-- 답변 리스트 -->
        <div class="answer-list-section" th:if="${#lists.size(reservation.answerList) > 0}">
            <h3>💡 답변 목록</h3>
            <div th:each="answer : ${reservation.answerList}" class="answer-card">
                <div class="answer-meta">
                    <span>작성자: <b th:text="${answer.author.username}"></b></span>
                    <span>작성일: <span th:text="${#temporals.format(answer.createdate,'yyyy-MM-dd HH:mm')}"></span></span>
                    <span th:if="${answer.modifydate != null}">수정일: <span th:text="${#temporals.format(answer.modifydate,'yyyy-MM-dd HH:mm')}"></span></span>
                </div>
                <div class="answer-content" th:text="${answer.content}">답변 내용</div>

                <!-- 답변 수정/삭제 버튼 -->
                <div class="answer-actions" th:if="${#authentication.name == answer.author.username}">
                   <!-- <a th:href="@{|/answer/modify/${answer.id}|}" class="edit-btn">수정</a>-->
                    <a th:href="@{|/answer/delete/${answer.id}|}" class="delete-btn"
                       onclick="return confirm('정말 삭제하시겠습니까?');">삭제</a>
                       
                </div>
            </div>
        </div>

    </div>
</section>

<!-- Footer -->
<div th:replace="/footer :: footer"></div>

</body>
</html>
