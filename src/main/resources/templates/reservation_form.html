<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8">
    <title>상품 글쓰기 + 예약</title>
    <link rel="stylesheet" th:href="@{/css/board_form_market.css}">
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <style>
        .image-preview { display:flex; flex-wrap:wrap; gap:10px; margin-top:10px; }
        .preview-img { width:120px; height:120px; object-fit:cover; border-radius:6px; box-shadow:0 2px 6px rgba(0,0,0,0.1);}
        .modal { display:none; position:fixed; z-index:999; left:0; top:0; width:100%; height:100%; background-color:rgba(0,0,0,0.5); justify-content:center; align-items:center; }
        .modal-content { background-color:#FFF8F0; padding:20px; border-radius:12px; max-width:400px; width:90%; box-shadow:0 2px 10px rgba(0,0,0,0.2);}
        .modal-header { font-weight:bold; margin-bottom:10px; color:#5C4033;}
        .modal-actions { display:flex; gap:10px; justify-content:flex-end; margin-top:10px;}
        .modal-actions button { padding:6px 12px; border-radius:6px; border:none; cursor:pointer; }
        .save-btn { background-color:#6B4226; color:#FFF8F0; }
        .save-btn:hover { background-color:#5C3A1F; }
        .cancel-btn-modal { background-color:#E2E8F0; color:#3B2F2F; }
        .cancel-btn-modal:hover { background-color:#CBD5E0; }
    </style>
    <script>
        function previewImages() {
            const preview = document.getElementById('image-preview');
            preview.innerHTML = '';
            const files = document.getElementById('images').files;
            if (files) {
                Array.from(files).forEach(file => {
                    const reader = new FileReader();
                    reader.onload = e => {
                        const img = document.createElement('img');
                        img.src = e.target.result;
                        img.className = 'preview-img';
                        preview.appendChild(img);
                    };
                    reader.readAsDataURL(file);
                });
            }
        }

        function openModal() { document.getElementById('modal').style.display = 'flex'; }
        function closeModal() { document.getElementById('modal').style.display = 'none'; }

        function saveReservation() {
            const date = document.getElementById('reserve-date').value;
            const time = document.getElementById('reserve-time').value;
            if (!date || !time) { alert("날짜와 시간을 모두 선택해주세요."); return; }

            const form = document.querySelector('form');
            let inputDate = form.querySelector('input[name="reserveDate"]');
            if (!inputDate) { inputDate = document.createElement('input'); inputDate.type='hidden'; inputDate.name='reserveDate'; form.appendChild(inputDate); }
            inputDate.value = date;

            let inputTime = form.querySelector('input[name="reserveTime"]');
            if (!inputTime) { inputTime = document.createElement('input'); inputTime.type='hidden'; inputTime.name='reserveTime'; form.appendChild(inputTime); }
            inputTime.value = time;

            alert(`예약 시간 설정 완료: ${date} ${time}`);
            closeModal();
        }
    </script>
</head>
<body>
<div th:replace="/header :: header"></div>

<section class="board-section">
    <div class="board-container">
        <h2 th:text="${reservation != null && reservation.id != null ? '글 수정하기' : '새 상품 글쓰기'}">글쓰기</h2>
		
        <form th:object="${reservationForm}" 
      th:action="${reservation.id != null} ? @{/reservation/modify/{id}(id=${reservation.id})} : @{/reservation/create}" 
      method="post" enctype="multipart/form-data">
            <!-- 제목 -->
            <div class="form-group">
                <label for="subject">제목</label>
                <input type="text" th:field="*{subject}" id="subject" placeholder="상품 이름 입력"/>
            </div>

            <!-- 내용 -->
            <div class="form-group">
                <label for="content">내용</label>
                <textarea th:field="*{content}" id="content" rows="5" placeholder="상품 설명"></textarea>
            </div>

           <!-- 가격 -->
			<div class="form-group">
			    <label for="price">가격</label>
			    <input type="text" th:field="*{price}" id="price" placeholder="가격 입력" 
			           pattern="^[1-9]\d*$" title="0보다 큰 숫자만 입력 가능합니다" required
			           oninput="this.value = this.value.replace(/[^0-9]/g, '')"/>
			</div>

            <!-- 거래 위치 -->
            <div class="form-group">
                <label for="location">거래 위치</label>
                <input type="text" th:field="*{location}" id="location" placeholder="예: 서울 강남"/>
            </div>

           

             <!-- 예약일 / 예약시간 -->
    <div class="form-group">
        <label for="reserve-date">예약일</label>
        <input type="date" th:field="*{reserveDate}" id="reserve-date" required/>

        <label for="reserve-time">예약시간</label>
        <input type="time" th:field="*{reserveTime}" id="reserve-time" required/>
    </div>

            <!-- 제출 버튼 -->
            <div class="form-actions">
                <input type="submit" value="저장하기" class="submit-btn"/>
                <a th:href="@{/reservation/list}" class="cancel-btn">취소</a>
            </div>
        </form>
    </div>
</section>

<!-- 예약 모달
<div id="modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">예약 시간 설정</div>
        <div class="modal-body">
            <label for="reserve-date">날짜 선택</label>
            <input type="date" id="reserve-date"/><br/><br/>
            <label for="reserve-time">시간 선택</label>
            <input type="time" id="reserve-time"/>
        </div> -->
        <div class="modal-actions">
            <button class="cancel-btn-modal" onclick="closeModal()">취소</button>
            <button class="save-btn" onclick="saveReservation()">저장</button>
        </div>
    </div>
</div>

<div th:replace="/footer :: footer"></div>
</body>
</html>
